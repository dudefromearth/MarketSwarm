{
  "version": "3.1",
  "description": "Truth: Host-based Redis topology for MarketSwarm stack. Canonical configuration for all services.",

  "buses": {
    "system-redis": {
      "url": "redis://127.0.0.1:6379",
      "role": "governance",
      "description": "Primary coordination, truth, heartbeat, and system events bus."
    },
    "market-redis": {
      "url": "redis://127.0.0.1:6380",
      "role": "market-data",
      "description": "Real-time market and chainfeed publication bus for Massive and Vexy."
    },
    "intel-redis": {
      "url": "redis://127.0.0.1:6381",
      "role": "content",
      "description": "Dedicated RSS ingestion and enrichment bus for RSSAgg and Vexy."
    }
  },

  "domain": {
  "keys": {
    "rss:index":  { "type": "ZSET",   "ttl_sec": 86400 },
    "rss:queue":  { "type": "STREAM", "ttl_sec": 86400 },
    "rss:seen":   { "type": "SET",    "ttl_sec": 86400 },
    "rss:item:{uid}": { "type": "HASH", "ttl_sec": 86400 },

    "massive:chain:{uid}": { "type": "HASH", "ttl_sec": 86400 },
    "sse:chain-feed":      { "type": "STREAM", "ttl_sec": 86400 },

    "rss:article_enriched_index": { "type": "ZSET", "ttl_sec": 604800 },
    "rss:article_enriched:{uid}": { "type": "HASH", "ttl_sec": 604800 },
    "rss:article_canonical:{uid}": { "type": "HASH", "ttl_sec": 604800 }
  }
},

  "components": {
    "rss_agg": {
      "meta": {
        "name": "RSS Aggregator",
        "description": "Ingests, enriches, and republishes RSS feeds."
      },
      "access_points": {
        "publish_to": [
          { "bus": "intel-redis", "key": "vexy:intake" },
          { "bus": "system-redis", "key": "rss_agg:heartbeat" }
        ],
        "subscribe_to": [],
        "index_key": "rss:index",
        "queue_key": "rss:queue"
      },
      "heartbeat": {
        "interval_sec": 5,
        "ttl_sec": 15,
        "channel": "rss_agg:heartbeat"
      },
      "workflow": {
        "interval_sec": 600,
        "publish_dir": "/Users/ernie/Sites/feeds"
      },
      "domain_keys": [
        "rss:index",
        "rss:queue",
        "rss:seen",
        "rss:item:{uid}"
      ],
      "dependencies": []
    },

    "content_anal": {
      "meta": {
        "name": "Content Analysis Engine",
        "description": "LLM-driven category analysis of enriched content, produces synthetic insights adapted the the original content shema."
      },
      "access_points": {
        "subscribe_to": [
          { "bus": "intel-redis", "key": "vexy:intake" }
        ],
        "publish_to": [
          { "bus": "intel-redis", "key": "content_anal:outbox" },
          { "bus": "system-redis", "key": "content_anal:heartbeat" }
        ]
      },
      "heartbeat": {
        "interval_sec": 15,
        "ttl_sec": 45,
        "channel": "content_anal:heartbeat"
      },
      "domain_keys": [
        "rss:index",
        "rss:article_enriched_index",
        "rss:article_enriched:{uid}"
      ],
      "dependencies": ["rss_agg"]
    },

    "vigil": {
      "meta": {
        "name": "Market Event Watcher",
        "description": "Filters for market events, send to Vexy."
      },
      "access_points": {
        "publish_to": [
          { "bus": "market-redis", "key": "vigil:events" },
          { "bus": "system-redis", "key": "vigil:heartbeat" }
        ],
        "subscribe_to": [
          { "bus": "market-redis",  "key": "sse:chain-feed" }
        ]
      },
      "heartbeat": {
        "interval_sec": 5,
        "ttl_sec": 15,
        "channel": "vigil:heartbeat"
      },
      "dependencies": []
    },

"massive": {
  "meta": {
    "name": "Massive Market Data Engine",
    "description": "Real-time SPX market engine providing chainfeed, SPYâ†’SPX volume profile, time-series data, and convexity digests."
  },
  "access_points": {
    "publish_to": [
      { "bus": "market-redis", "key": "sse:chain-feed" },
      { "bus": "market-redis", "key": "sse:volume-profile" },
      { "bus": "market-redis", "key": "sse:timeseries" },
      { "bus": "market-redis", "key": "sse:convexity-feed" },
      { "bus": "system-redis", "key": "massive:heartbeat" }
    ],
    "subscribe_to": []
  },
  "heartbeat": {
    "interval_hz": 2,
    "ttl_sec": 10,
    "channel": "massive:heartbeat"
  },
  "domain_keys": [
    "massive:chain:{uid}",
    "massive:volume_profile:{uid}",
    "massive:timeseries:{uid}",
    "sse:chain-feed",
    "sse:volume-profile",
    "sse:timeseries",
    "sse:convexity-feed"
  ],
  "workflow": {
    "symbol": "SPX",
    "spy_symbol": "SPY",
    "api_key_env": "POLYGON_API_KEY",
    "volume_profile": {
      "enabled": true,
      "spy_to_spx_scale": 10.0,
      "bin_size_spy": 0.01,
      "window_days": 365,
      "dynamic_price_span": true
    },
    "publish_chainfeed": true,
    "publish_volume_profile": true,
    "publish_timeseries": true,
    "publish_convexity": false
  },
  "dependencies": []
},

    "vexy_ai": {
      "meta": {
        "name": "Vexy AI",
        "description": "Epoch + event-driven play-by-play voice. Consumes market and RSS streams, publishes real-time commentary."
      },
  "access_points": {
    "subscribe_to": [
      { "bus": "intel-redis",  "key": "vexy:intake" },
      { "bus": "market-redis", "key": "sse:chain-feed" },
      { "bus": "market-redis", "key": "sse:volume-profile" },
      { "bus": "market-redis", "key": "sse:timeseries" },
      { "bus": "market-redis", "key": "vigil:events" }
    ],
    "publish_to": [
      { "bus": "system-redis", "key": "vexy_ai:heartbeat" },
      { "bus": "market-redis", "key": "vexy:playbyplay" }
    ]
  },
      "heartbeat": {
        "interval_sec": 15,
        "ttl_sec": 45,
        "channel": "vexy_ai:heartbeat"
      },
      "restart_cmd": "/Users/ernie/MarketSwarm/scripts/ms-vexyai.sh restart",
      "dependencies": ["rss_agg", "massive"],
      "domain_keys": []
    },

    "mesh": {
      "meta": {
        "name": "Mesh Coordinator",
        "description": "Maintains service registry and monitors heartbeat health."
      },
      "access_points": {
        "publish_to": [
          { "bus": "system-redis", "key": "mesh:heartbeat" },
          { "bus": "system-redis", "key": "mesh:gossip" }
        ],
        "subscribe_to": []
      },
      "heartbeat": {
        "interval_sec": 5,
        "ttl_sec": 15,
        "channel": "mesh:heartbeat"
      },
      "dependencies": []
    },

    "healer": {
      "meta": {
        "name": "Healer",
        "description": "Watches all service heartbeats and restarts or alerts when any fail."
      },
      "access_points": {
        "subscribe_to": [
          { "bus": "system-redis", "key": "rss_agg:heartbeat" },
          { "bus": "system-redis", "key": "massive:heartbeat" },
          { "bus": "system-redis", "key": "vexy_ai:heartbeat" },
          { "bus": "system-redis", "key": "mesh:heartbeat" }
        ],
        "publish_to": [
          { "bus": "system-redis", "key": "healer:heartbeat" },
          { "bus": "system-redis", "key": "healer:alerts" }
        ]
      },
      "heartbeat": {
        "interval_sec": 10,
        "ttl_sec": 30,
        "channel": "healer:heartbeat"
      },
      "dependencies": []
    }
  }
}