{
  "version": "3.1",
  "description": "Truth: Host-based Redis topology for MarketSwarm stack. Canonical configuration for all services.",

  "buses": {
    "system-redis": {
      "url": "redis://127.0.0.1:6379",
      "role": "governance",
      "description": "Primary coordination, truth, heartbeat, and system events bus."
    },
    "market-redis": {
      "url": "redis://127.0.0.1:6380",
      "role": "market-data",
      "description": "Real-time market and chainfeed publication bus for Massive and Vexy."
    },
    "intel-redis": {
      "url": "redis://127.0.0.1:6381",
      "role": "content",
      "description": "Dedicated RSS ingestion and enrichment bus for RSSAgg and Vexy."
    }
  },

  "domain": {
    "keys": {
      "rss:index":  { "type": "ZSET",   "ttl_sec": 86400 },
      "rss:queue":  { "type": "STREAM", "ttl_sec": 86400 },
      "rss:seen":   { "type": "SET",    "ttl_sec": 86400 },
      "rss:item:{uid}": { "type": "HASH", "ttl_sec": 86400 },

      "massive:chain:{uid}": { "type": "HASH", "ttl_sec": 86400 },
      "sse:chain-feed":      { "type": "STREAM", "ttl_sec": 86400 },

      "rss:article_enriched_index": { "type": "ZSET", "ttl_sec": 604800 },
      "rss:article_enriched:{uid}": { "type": "HASH", "ttl_sec": 604800 },
      "rss:article_canonical:{uid}": { "type": "HASH", "ttl_sec": 604800 }
    }
  },

  "components": {
    "rss_agg": {
      "meta": {
        "name": "RSS Aggregator",
        "description": "Ingests, enriches, and republishes RSS feeds."
      },
      "access_points": {
        "publish_to": [
          { "bus": "intel-redis", "key": "vexy:intake" },
          { "bus": "system-redis", "key": "rss_agg:heartbeat" }
        ],
        "subscribe_to": [],
        "index_key": "rss:index",
        "queue_key": "rss:queue"
      },
      "heartbeat": {
        "interval_sec": 5,
        "ttl_sec": 15,
        "channel": "rss_agg:heartbeat"
      },
      "workflow": {
        "interval_sec": 600,
        "publish_dir": "/Users/ernie/Sites/feeds"
      },
      "domain_keys": [
        "rss:index",
        "rss:queue",
        "rss:seen",
        "rss:item:{uid}"
      ],
      "dependencies": []
    },

    "content_anal": {
      "meta": {
        "name": "Content Analysis Engine",
        "description": "LLM-driven category analysis of enriched content, produces synthetic insights adapted the original content schema."
      },
      "access_points": {
        "subscribe_to": [
          { "bus": "intel-redis", "key": "vexy:intake" }
        ],
        "publish_to": [
          { "bus": "intel-redis", "key": "content_anal:outbox" },
          { "bus": "system-redis", "key": "content_anal:heartbeat" }
        ]
      },
      "heartbeat": {
        "interval_sec": 15,
        "ttl_sec": 45,
        "channel": "content_anal:heartbeat"
      },
      "domain_keys": [
        "rss:index",
        "rss:article_enriched_index",
        "rss:article_enriched:{uid}"
      ],
      "dependencies": ["rss_agg"]
    },

    "vigil": {
      "meta": {
        "name": "Market Event Watcher",
        "description": "Filters for market events, sends to Vexy."
      },
      "access_points": {
        "publish_to": [
          { "bus": "market-redis", "key": "vigil:events" },
          { "bus": "system-redis", "key": "vigil:heartbeat" }
        ],
        "subscribe_to": [
          { "bus": "market-redis", "key": "sse:timeseries" },
          { "bus": "market-redis", "key": "sse:chain-feed" }
        ]
      },
      "heartbeat": {
        "interval_sec": 5,
        "ttl_sec": 15,
        "channel": "vigil:heartbeat"
      },
      "dependencies": []
    },

"massive": {
  "meta": {
    "name": "Massive Market Data Engine",
    "description": "Real-time market engine pulling options chains, preprocessing contract data, and publishing UI-ready models."
  },
  "access_points": {
    "publish_to": [
      { "bus": "market-redis", "key": "massive:model:gex" },
      { "bus": "market-redis", "key": "massive:model:heatmap" },
      { "bus": "market-redis", "key": "massive:model:market_mode" },
      { "bus": "market-redis", "key": "massive:model:vix_regime" },
      { "bus": "market-redis", "key": "massive:model:bias_fi" },
      { "bus": "market-redis", "key": "massive:model:volume_profile" },
      { "bus": "system-redis", "key": "massive:heartbeat" }
    ],
    "subscribe_to": []
  },
  "heartbeat": {
    "interval_sec": 1,
    "ttl_sec": 15,
    "channel": "massive:heartbeat"
  },
  "domain_keys": [
    "massive:chain:{symbol}:{expiration}",
    "massive:model:gex",
    "massive:model:heatmap",
    "massive:model:market_mode",
    "massive:model:vix_regime",
    "massive:model:bias_fi",
    "massive:model:volume_profile"
  ],
  "models": {
    "produces": [
      "massive.market.gex",
      "massive.market.heatmap",
      "massive.market.market_mode",
      "massive.market.vix_regime",
      "massive.market.bias_fi",
      "massive.market.volume_profile"
    ],
    "consumes": []
  },
  "workflow": {
    "symbols": ["I:SPX", "I:NDX", "SPY", "QQQ"],
    "strike_ranges": {
      "I:SPX": 100,
      "I:NDX": 350,
      "SPY": 10,
      "QQQ": 20
    },
    "num_expirations": 5,
    "use_strict_gt_lt": false,
    "redis_prefix": "chain",
    "api_key_env": "MASSIVE_API_KEY",
    "poll_interval_sec": 10,
    "threading_enabled": true
  },
  "dependencies": []
},

    "vexy_ai": {
      "meta": {
        "name": "Vexy AI",
        "description": "Epoch + event-driven play-by-play voice. Consumes market UI models, events, and RSS content; produces human-readable commentary."
      },
      "access_points": {
        "subscribe_to": [
          { "bus": "intel-redis",  "key": "vexy:intake" },
          { "bus": "market-redis", "key": "vigil:events" },

          { "bus": "market-redis", "key": "massive:model:gex" },
          { "bus": "market-redis", "key": "massive:model:heatmap" },
          { "bus": "market-redis", "key": "massive:model:market_mode" },
          { "bus": "market-redis", "key": "massive:model:vix_regime" },
          { "bus": "market-redis", "key": "massive:model:volume_profile" },
          { "bus": "market-redis", "key": "massive:model:bias_fi" }
        ],
        "publish_to": [
          { "bus": "system-redis", "key": "vexy_ai:heartbeat" },
          { "bus": "market-redis", "key": "vexy:model:playbyplay" }
        ]
      },
      "heartbeat": {
        "interval_sec": 15,
        "ttl_sec": 45,
        "channel": "vexy_ai:heartbeat"
      },
      "restart_cmd": "/Users/ernie/MarketSwarm/scripts/ms-vexyai.sh restart",
      "dependencies": ["rss_agg", "massive", "vigil"],
      "domain_keys": [
        "vexy:model:playbyplay"
      ],
      "models": {
        "produces": [
          "vexy:model:playbyplay"
        ],
        "consumes": [
          "massive:model:gex",
          "massive:model:heatmap",
          "massive:model:market_mode",
          "massive:model:vix_regime",
          "massive:model:volume_profile",
          "massive:model:bias_fi"
        ]
      }
    },

    "sse": {
      "meta": {
        "name": "SSE UI Gateway",
        "description": "Server-Sent Events gateway responsible for transforming backend models into live UI streams for the React client."
      },
      "access_points": {
        "subscribe_to": [
          { "bus": "market-redis", "key": "massive:model:gex" },
          { "bus": "market-redis", "key": "massive:model:heatmap" },
          { "bus": "market-redis", "key": "massive:model:market_mode" },
          { "bus": "market-redis", "key": "massive:model:vix_regime" },
          { "bus": "market-redis", "key": "massive:model:bias_fi" },

          { "bus": "market-redis", "key": "rss:model:sentiment" },
          { "bus": "market-redis", "key": "rss:model:trending" },

          { "bus": "market-redis", "key": "vexy:model:playbyplay" }
        ],
        "publish_to": [
          { "bus": "system-redis", "key": "sse:heartbeat" },
          { "bus": "market-redis", "key": "ui:gex" },
          { "bus": "market-redis", "key": "ui:heatmap" },
          { "bus": "market-redis", "key": "ui:market_mode" },
          { "bus": "market-redis", "key": "ui:vix_regime" },
          { "bus": "market-redis", "key": "ui:bias_fi" },
          { "bus": "market-redis", "key": "ui:sentiment" },
          { "bus": "market-redis", "key": "ui:trending_news" },
          { "bus": "market-redis", "key": "ui:playbyplay" }
        ]
      },
      "heartbeat": {
        "interval_sec": 5,
        "ttl_sec": 15,
        "channel": "sse:heartbeat"
      },

      "models": {
        "produces": [],
        "consumes": [
          "massive:model:gex",
          "massive:model:heatmap",
          "massive:model:market_mode",
          "massive:model:vix_regime",
          "massive:model:bias_fi",

          "rss:model:sentiment",
          "rss:model:trending",

          "vexy:model:playbyplay"
        ]
      },

      "domain_keys": [
        "massive:model:gex",
        "massive:model:heatmap",
        "massive:model:market_mode",
        "massive:model:vix_regime",
        "massive:model:bias_fi",

        "rss:model:sentiment",
        "rss:model:trending",

        "vexy:model:playbyplay",

        "ui:gex",
        "ui:heatmap",
        "ui:market_mode",
        "ui:vix_regime",
        "ui:bias_fi",
        "ui:sentiment",
        "ui:trending_news",
        "ui:playbyplay"
      ],

      "workflow": {
        "ui_channels": {
          "gex": "ui:gex",
          "heatmap": "ui:heatmap",
          "market_mode": "ui:market_mode",
          "vix_regime": "ui:vix_regime",
          "bias_fi": "ui:bias_fi",
          "sentiment": "ui:sentiment",
          "trending_news": "ui:trending_news",
          "playbyplay": "ui:playbyplay"
        },
        "buffer_ms": 50,
        "compression": true
      },

      "dependencies": [
        "massive",
        "rss_agg",
        "vexy_ai"
      ]
    },

    "mesh": {
      "meta": {
        "name": "Mesh Coordinator",
        "description": "Maintains service registry and monitors heartbeat health."
      },
      "access_points": {
        "publish_to": [
          { "bus": "system-redis", "key": "mesh:heartbeat" },
          { "bus": "system-redis", "key": "mesh:gossip" }
        ],
        "subscribe_to": []
      },
      "heartbeat": {
        "interval_sec": 5,
        "ttl_sec": 15,
        "channel": "mesh:heartbeat"
      },
      "dependencies": []
    },

    "healer": {
      "meta": {
        "name": "Healer",
        "description": "Watches all service heartbeats and restarts or alerts when any fail."
      },
      "access_points": {
        "subscribe_to": [
          { "bus": "system-redis", "key": "rss_agg:heartbeat" },
          { "bus": "system-redis", "key": "massive:heartbeat" },
          { "bus": "system-redis", "key": "vexy_ai:heartbeat" },
          { "bus": "system-redis", "key": "mesh:heartbeat" }
        ],
        "publish_to": [
          { "bus": "system-redis", "key": "healer:heartbeat" },
          { "bus": "system-redis", "key": "healer:alerts" }
        ]
      },
      "heartbeat": {
        "interval_sec": 10,
        "ttl_sec": 30,
        "channel": "healer:heartbeat"
      },
      "dependencies": []
    }
  }
}