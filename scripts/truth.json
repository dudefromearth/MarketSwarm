{
  "version": "3.1",
  "description": "Truth: Host-based Redis topology for MarketSwarm stack. Canonical configuration for all services.",

  "buses": {
    "system-redis": {
      "url": "redis://127.0.0.1:6379",
      "role": "governance",
      "description": "Primary coordination, truth, heartbeat, and system events bus."
    },
    "market-redis": {
      "url": "redis://127.0.0.1:6380",
      "role": "market-data",
      "description": "Real-time market and chainfeed publication bus for Massive and Vexy."
    },
    "intel-redis": {
      "url": "redis://127.0.0.1:6381",
      "role": "content",
      "description": "Dedicated RSS ingestion and enrichment bus for RSSAgg and Vexy."
    }
  },

  "domain": {
    "keys": {
      "rss:index":  { "type": "ZSET",   "ttl_sec": 86400 },
      "rss:queue":  { "type": "STREAM", "ttl_sec": 86400 },
      "rss:seen":   { "type": "SET",    "ttl_sec": 86400 },
      "rss:item:{uid}": { "type": "HASH", "ttl_sec": 86400 },

      "massive:chain:{uid}": { "type": "HASH", "ttl_sec": 86400 },
      "sse:chain-feed":      { "type": "STREAM", "ttl_sec": 86400 }
    }
  },

  "components": {
    "rss_agg": {
      "meta": {
        "name": "RSS Aggregator",
        "description": "Ingests, enriches, and republishes RSS feeds."
      },
      "access_points": {
        "publish_to": [
          { "bus": "intel-redis", "key": "vexy:intake" },
          { "bus": "system-redis", "key": "rss_agg:heartbeat" }
        ],
        "subscribe_to": [],
        "index_key": "rss:index",
        "queue_key": "rss:queue"
      },
      "heartbeat": {
        "interval_sec": 5,
        "ttl_sec": 15,
        "channel": "rss_agg:heartbeat"
      },
      "workflow": {
        "interval_sec": 600,
        "publish_dir": "/Users/ernie/Sites/feeds"
      },
      "domain_keys": [
        "rss:index",
        "rss:queue",
        "rss:seen",
        "rss:item:{uid}"
      ],
      "dependencies": []
    },

    "massive": {
      "meta": {
        "name": "Massive ChainFeed Service",
        "description": "Harvests SPX option chain and publishes deltas to market bus."
      },
      "access_points": {
        "publish_to": [
          { "bus": "market-redis", "key": "sse:chain-feed" },
          { "bus": "system-redis", "key": "massive:heartbeat" }
        ],
        "subscribe_to": []
      },
      "heartbeat": {
        "interval_hz": 2,
        "ttl_sec": 10,
        "channel": "massive:heartbeat"
      },
      "domain_keys": [
        "massive:chain:{uid}",
        "sse:chain-feed"
      ],
      "workflow": {
        "symbol": "SPX",
        "api_key_env": "POLYGON_API_KEY"
      },
      "dependencies": []
    },

    "vexy_ai": {
      "meta": {
        "name": "Vexy AI",
        "description": "Consumes market and RSS streams, generates derived intelligence and alerts."
      },
      "access_points": {
        "subscribe_to": [
          { "bus": "intel-redis", "key": "vexy:intake" },
          { "bus": "market-redis", "key": "sse:chain-feed" }
        ],
        "publish_to": [
          { "bus": "system-redis", "key": "vexy_ai:heartbeat" },
          { "bus": "intel-redis", "key": "intel:reports" }
        ]
      },
      "heartbeat": {
        "interval_sec": 5,
        "ttl_sec": 15,
        "channel": "vexy_ai:heartbeat"
      },
      "dependencies": ["rss_agg", "massive"],
      "domain_keys": []
    },

    "mesh": {
      "meta": {
        "name": "Mesh Coordinator",
        "description": "Maintains service registry and monitors heartbeat health."
      },
      "access_points": {
        "publish_to": [
          { "bus": "system-redis", "key": "mesh:heartbeat" },
          { "bus": "system-redis", "key": "mesh:gossip" }
        ],
        "subscribe_to": []
      },
      "heartbeat": {
        "interval_sec": 5,
        "ttl_sec": 15,
        "channel": "mesh:heartbeat"
      },
      "dependencies": []
    },

    "healer": {
      "meta": {
        "name": "Healer",
        "description": "Watches all service heartbeats and restarts or alerts when any fail."
      },
      "access_points": {
        "subscribe_to": [
          { "bus": "system-redis", "key": "rss_agg:heartbeat" },
          { "bus": "system-redis", "key": "massive:heartbeat" },
          { "bus": "system-redis", "key": "vexy_ai:heartbeat" },
          { "bus": "system-redis", "key": "mesh:heartbeat" }
        ],
        "publish_to": [
          { "bus": "system-redis", "key": "healer:heartbeat" },
          { "bus": "system-redis", "key": "healer:alerts" }
        ]
      },
      "heartbeat": {
        "interval_sec": 10,
        "ttl_sec": 30,
        "channel": "healer:heartbeat"
      },
      "dependencies": []
    }
  }
}