{
  "version": "3.0",
  "description": "Truth: Host-based Redis topology for MarketSwarm stack. Simplified for direct OS-level services without Docker or containers.",
  "buses": {
    "system-redis": {
      "url": "redis://127.0.0.1:6379",
      "role": "governance",
      "description": "Primary coordination, truth, and heartbeat bus for all services."
    },
    "market-redis": {
      "url": "redis://127.0.0.1:6380",
      "role": "market-data",
      "description": "Real-time market and chainfeed publication bus for Massive and Vexy."
    },
    "rss-redis": {
      "url": "redis://127.0.0.1:6381",
      "role": "content",
      "description": "Dedicated RSS ingestion and enrichment bus for RSSAgg and Vexy."
    }
  },

  "components": {
    "rss_agg": {
      "meta": {
        "name": "RSS Aggregator",
        "description": "Ingests, enriches, and republishes RSS feeds for Vexy and external publication."
      },
      "access_points": {
        "publish_to": [
          { "bus": "rss-redis", "key": "rss:queue" },
          { "bus": "system-redis", "key": "rss_agg:heartbeat" }
        ],
        "subscribe_to": [],
        "index_key": "rss:index",
        "queue_key": "rss:queue"
      },
      "workflow": {
        "interval_sec": 600,
        "publish_dir": "/app/feeds"
      },
      "dependencies": []
    },

    "massive": {
      "meta": {
        "name": "Massive ChainFeed Service",
        "description": "Harvests SPX option chain via Polygon REST and publishes deltas to market bus."
      },
      "access_points": {
        "publish_to": [
          { "bus": "market-redis", "key": "sse:chain-feed" },
          { "bus": "system-redis", "key": "massive:heartbeat" }
        ],
        "subscribe_to": []
      },
      "workflow": {
        "interval_hz": 2,
        "symbol": "SPX",
        "api_key_env": "POLYGON_API_KEY"
      },
      "dependencies": []
    },

    "vexy_ai": {
      "meta": {
        "name": "Vexy AI",
        "description": "Consumes market and RSS streams, generates derived intelligence and alerts."
      },
      "access_points": {
        "subscribe_to": [
          { "bus": "rss-redis", "key": "rss:queue" },
          { "bus": "market-redis", "key": "sse:chain-feed" }
        ],
        "publish_to": [
          { "bus": "system-redis", "key": "vexy_ai:heartbeat" },
          { "bus": "rss-redis", "key": "intel:reports" }
        ]
      },
      "dependencies": ["rss_agg", "massive"]
    },

    "mesh": {
      "meta": {
        "name": "Mesh Coordinator",
        "description": "Maintains service registry and monitors heartbeat health."
      },
      "access_points": {
        "publish_to": [
          { "bus": "system-redis", "key": "mesh:heartbeat" },
          { "bus": "system-redis", "key": "mesh:gossip" }
        ],
        "subscribe_to": []
      },
      "dependencies": []
    },

    "healer": {
      "meta": {
        "name": "Healer",
        "description": "Watches all service heartbeats and restarts or alerts when any fail."
      },
      "access_points": {
        "subscribe_to": [
          { "bus": "system-redis", "key": "rss_agg:heartbeat" },
          { "bus": "system-redis", "key": "massive:heartbeat" },
          { "bus": "system-redis", "key": "vexy_ai:heartbeat" },
          { "bus": "system-redis", "key": "mesh:heartbeat" }
        ],
        "publish_to": [
          { "bus": "system-redis", "key": "healer:heartbeat" },
          { "bus": "system-redis", "key": "healer:alerts" }
        ]
      },
      "heartbeat": {
        "interval_sec": 10,
        "channel": "healer:heartbeat"
      },
      "dependencies": []
    }
  }
}