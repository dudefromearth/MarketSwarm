{
  "version": "3.1",
  "description": "Truth: Host-based Redis topology for MarketSwarm stack. Canonical configuration for all services.",
  "buses": {
    "system-redis": {
      "url": "redis://127.0.0.1:6379",
      "role": "system",
      "description": "Governance, truth, heartbeats, mesh, healer."
    },
    "market-redis": {
      "url": "redis://127.0.0.1:6380",
      "role": "market",
      "description": "Market data, chains, models, vigil events."
    },
    "intel-redis": {
      "url": "redis://127.0.0.1:6381",
      "role": "intel",
      "description": "RSS & external intel ingestion, enrichment, sentiment."
    }
  },
  "domain": {},
  "components": {
    "rss_agg": {
      "id": "rss_agg",
      "meta": {
        "name": "RSS Aggregator",
        "description": "Ingests, enriches, and republishes RSS feeds."
      },
      "access_points": {
        "publish_to": [
          {
            "bus": "intel-redis",
            "key": "vexy:intake"
          },
          {
            "bus": "system-redis",
            "key": "rss_agg:heartbeat"
          }
        ],
        "subscribe_to": [],
        "index_key": "rss:index",
        "queue_key": "rss:queue"
      },
      "heartbeat": {
        "interval_sec": 5,
        "ttl_sec": 15
      },
      "workflow": {
        "interval_sec": 600,
        "publish_dir": "/Users/ernie/Sites/feeds"
      },
      "dependencies": []
    },
    "content_anal": {
      "id": "content_anal",
      "meta": {
        "name": "Content Analysis Engine",
        "description": "LLM-driven category analysis of enriched content, produces synthetic insights adapted the original content schema."
      },
      "access_points": {
        "subscribe_to": [
          {
            "bus": "intel-redis",
            "key": "vexy:intake"
          }
        ],
        "publish_to": [
          {
            "bus": "intel-redis",
            "key": "content_anal:outbox"
          },
          {
            "bus": "system-redis",
            "key": "content_anal:heartbeat"
          }
        ]
      },
      "heartbeat": {
        "interval_sec": 15,
        "ttl_sec": 45
      },
      "domain_keys": [
        "rss:index",
        "rss:article_enriched_index",
        "rss:article_enriched:{uid}"
      ],
      "dependencies": [
        "rss_agg"
      ]
    },
    "vigil": {
      "id": "vigil",
      "meta": {
        "name": "Market Event Watcher",
        "description": "Filters for market events, sends to Vexy."
      },
      "access_points": {
        "publish_to": [
          {
            "bus": "market-redis",
            "key": "vigil:events"
          },
          {
            "bus": "system-redis",
            "key": "vigil:heartbeat"
          }
        ],
        "subscribe_to": [
          {
            "bus": "market-redis",
            "key": "massive:spot"
          },
          {
            "bus": "market-redis",
            "key": "massive:chain:latest"
          }
        ]
      },
      "heartbeat": {
        "interval_sec": 5,
        "ttl_sec": 15
      },
      "dependencies": []
    },
    "massive": {
      "id": "massive",
      "meta": {
        "name": "Massive Market Model",
        "description": "Ingests live spot and options data from the provider and publishes near real-time options surface and raw convexity inputs into Market-Redis."
      },
      "access_points": {
        "subscribe_to": [],
        "publish_to": [
          {
            "bus": "system-redis",
            "key": "massive:heartbeat"
          },
          {
            "bus": "market-redis",
            "key": "massive:chain:latest"
          },
          {
            "bus": "market-redis",
            "key": "massive:ws:contracts"
          },
          {
            "bus": "market-redis",
            "key": "massive:ws:stream"
          },
          {
            "bus": "market-redis",
            "key": "massive:spot"
          },
          {
            "bus": "market-redis",
            "key": "massive:debug"
          },
          {
            "bus": "market-redis",
            "key": "massive:spot:analytics"
          },
          {
            "bus": "market-redis",
            "key": "massive:ws:analytics"
          },
          {
            "bus": "market-redis",
            "key": "massive:chain:analytics"
          },
          {
            "bus": "market-redis",
            "key": "massive:model:analytics"
          },
          {
            "bus": "market-redis",
            "key": "massive:heatmap:model:{symbol}:latest"
          },
          {
            "bus": "market-redis",
            "key": "massive:heatmap:replay:{symbol}"
          }
        ]
      },
      "models": {
        "produces": [
          {
            "bus": "market-redis",
            "key": "massive:model:spot"
          },
          {
            "bus": "market-redis",
            "key": "massive:gex:model"
          },
          {
            "bus": "market-redis",
            "key": "massive:heatmap:model:{symbol}:latest"
          },
          {
            "bus": "market-redis",
            "key": "massive:heatmap:replay:{symbol}"
          },
          {
            "bus": "market-redis",
            "key": "massive:market_mode:model"
          },
          {
            "bus": "market-redis",
            "key": "massive:vix_regime:model"
          },
          {
            "bus": "market-redis",
            "key": "massive:volume_profile:model"
          },
          {
            "bus": "market-redis",
            "key": "massive:bias_lfi:model"
          }
        ],
        "consumes": []
      },
      "heartbeat": {
        "interval_sec": 5,
        "ttl_sec": 15
      },
      "domain_keys": [
        "SPOT",
        "SPX",
        "NDX",
        "VIX",
        "OPTIONS",
        "GEX",
        "CONVEXITY"
      ],
      "dependencies": [],
      "env": {
        "MASSIVE_API_KEY": "pdjraOWSpDbg3ER_RslZYe3dmn4Y7WCC",
        "MASSIVE_WS_HYDRATE_MAX_DTE": "4",
        "MASSIVE_HEATMAP_MAX_DTE": "10",
        "MASSIVE_EPOCH_TTL_MINUTES": "390",
        "MASSIVE_EPOCH_SPOT_THRESHOLD_PCT": "1",
        "MASSIVE_SPOT_SYMBOLS": "I:SPX,I:NDX,I:VIX",
        "MASSIVE_SPOT_INDEX_TIMEOUT_SEC": "2.0",
        "MASSIVE_SPOT_STOCK_TIMEOUT_SEC": "2.5",
        "MASSIVE_SPOT_TICK_TIMEOUT_SEC": "5.0",
        "MASSIVE_REDIS_OP_TIMEOUT_SEC": "1.0",
        "MASSIVE_STOCK_SYMBOLS": "SPY, QQQ",
        "MASSIVE_CHAIN_SYMBOLS": "I:SPX,I:NDX",
        "MASSIVE_CHAIN_INTERVAL_SEC": "10",
        "MASSIVE_CHAIN_NUM_EXPIRATIONS": "4",
        "MASSIVE_CHAIN_EM_DAYS": "1",
        "MASSIVE_CHAIN_EM_MULT": "2.25",
        "MASSIVE_SPX_EM_MULT": "2.25",
        "MASSIVE_NDX_EM_MULT": "3.50",
        "MASSIVE_SPX_STRIKE_INCREMENT": "5",
        "MASSIVE_NDX_STRIKE_INCREMENT": "10",
        "MASSIVE_SPX_FILTER_STRIKES": "false",
        "MASSIVE_NDX_FILTER_STRIKES": "true",
        "MASSIVE_EPOCH_CHANGE_THRESHOLD_PCT": "15",
        "MASSIVE_SURFACE_TTL_MINUTES": "10080",
        "MASSIVE_CAPTURE_SURFACE": "true",
        "MASSIVE_WS_STRIKE_STEP": "5",
        "MASSIVE_WS_RECONNECT_DELAY_SEC": "5.0",
        "DEBUG_MASSIVE": "false",
        "MASSIVE_WS_URL": "wss://socket.massive.com/options",
        "MASSIVE_WS_REPLAY": "false",
        "MASSIVE_WS_CAPTURE": "false",
        "MASSIVE_WS_CAPTURE_CHAIN_DIR": "/Users/ernie/MarketSwarm/ws_captures/chain",
        "MASSIVE_WS_CAPTURE_SPOT_DIR": "/Users/ernie/MarketSwarm/ws_captures/spot",
        "MASSIVE_WS_CAPTURE_WS_DIR": "/Users/ernie/MarketSwarm/ws_captures/ws",
        "MASSIVE_WS_CAPTURE_UNDERLYINGS": "SPX,NDX",
        "MASSIVE_HEATMAP_INTERVAL_MS": "200",
        "MASSIVE_MODEL_LIVE_TTL_SEC": "259200",
        "MASSIVE_REPLAY_TTL_SEC": "86400",
        "MASSIVE_REPLAY_BUFFER_MINUTES": "15",
        "MASSIVE_WIDTHS_SPX": "20,25,30,35,40,45,50",
        "MASSIVE_WIDTHS_NDX": "50,60,70,80,100,120,130",
        "MASSIVE_DEBUG_ENABLED": "true",
        "MASSIVE_DEBUG_CHAIN_INTERVAL_SEC": "5"
      }
    },
    "vexy_ai": {
      "id": "vexy_ai",
      "meta": {
        "name": "Vexy AI",
        "description": "Epoch + event-driven play-by-play voice. Consumes market UI models, events, and RSS content; produces human-readable commentary."
      },
      "access_points": {
        "subscribe_to": [
          {
            "bus": "intel-redis",
            "key": "vexy:intake"
          },
          {
            "bus": "market-redis",
            "key": "vigil:events"
          }
        ],
        "publish_to": [
          {
            "bus": "system-redis",
            "key": "vexy_ai:heartbeat"
          },
          {
            "bus": "system-redis",
            "key": "mesh:broadcast"
          }
        ]
      },
      "models": {
        "produces": [
          {
            "bus": "market-redis",
            "key": "vexy:model:playbyplay"
          }
        ],
        "consumes": [
          {
            "bus": "market-redis",
            "key": "massive:gex:model"
          },
          {
            "bus": "market-redis",
            "key": "massive:heatmap:model:{symbol}:latest"
          },
          {
            "bus": "market-redis",
            "key": "massive:market_mode:model"
          },
          {
            "bus": "market-redis",
            "key": "massive:vix_regime:model"
          },
          {
            "bus": "market-redis",
            "key": "massive:volume_profile:model"
          },
          {
            "bus": "market-redis",
            "key": "massive:bias_lfi:model"
          }
        ]
      },
      "heartbeat": {
        "interval_sec": 15,
        "ttl_sec": 45
      },
      "restart_cmd": "/Users/ernie/MarketSwarm/scripts/ms-vexyai.sh restart",
      "dependencies": [
        "rss_agg",
        "massive",
        "vigil"
      ],
      "env": {
        "VEXY_MODE": "full",
        "VEXY_LOOP_SLEEP_SEC": "60",
        "XAI_API_KEY": "",
        "OPENAI_API_KEY": "",
        "CONVEXITY_ASSISTANT_ID": "asst_yNLi7GCN2q2TkixGLiDYLxwP"
      },
      "epochs": [
        {
          "name": "Premarket",
          "time": "08:00",
          "context": "Pre-market session. Futures setting the tone. Watch overnight developments."
        },
        {
          "name": "Post-Open",
          "time": "09:35",
          "context": "Opening rotation complete. Initial direction established. Volume normalizing."
        },
        {
          "name": "European Close",
          "time": "11:30",
          "context": "European markets closing. Cross-Atlantic flows shifting. Mid-morning inflection."
        },
        {
          "name": "Lunch Vol Crush",
          "time": "13:00",
          "context": "Lunch hour volatility compression. Low participation. Watch for mean reversion setups."
        },
        {
          "name": "Commodity Shadow",
          "time": "14:00",
          "context": "Commodity markets closing. Energy and metals flows impacting equity correlation."
        },
        {
          "name": "Power Hour Begins",
          "time": "15:00",
          "context": "Final hour approaching. Institutional repositioning. Volume acceleration."
        },
        {
          "name": "Into the Close",
          "time": "15:50",
          "context": "Closing imbalances revealing. MOC orders driving final moves. Gamma intensifying."
        },
        {
          "name": "Post-Close Wrap",
          "time": "16:01",
          "context": "Cash session closed. Reviewing the day. After-hours positioning."
        }
      ]
    },
    "journal": {
      "id": "journal",
      "meta": {
        "name": "Trade Journal",
        "description": "Trade logging, journaling, and performance analytics. Standalone REST API with SQLite storage."
      },
      "access_points": {
        "subscribe_to": [
          {
            "bus": "market-redis",
            "key": "massive:spot"
          }
        ],
        "publish_to": [
          {
            "bus": "system-redis",
            "key": "journal:heartbeat"
          }
        ]
      },
      "heartbeat": {
        "interval_sec": 5,
        "ttl_sec": 15
      },
      "models": {
        "produces": [],
        "consumes": [
          {
            "bus": "market-redis",
            "key": "massive:heatmap:model:{symbol}:latest"
          }
        ]
      },
      "dependencies": [
        "massive"
      ],
      "env": {
        "JOURNAL_PORT": "3002"
      }
    },
    "sse": {
      "id": "sse",
      "meta": {
        "name": "SSE UI Gateway",
        "description": "Server-Sent Events gateway responsible for transforming backend models into live UI streams for the React client."
      },
      "access_points": {
        "subscribe_to": [],
        "publish_to": [
          {
            "bus": "system-redis",
            "key": "sse:heartbeat"
          }
        ]
      },
      "heartbeat": {
        "interval_sec": 5,
        "ttl_sec": 15
      },
      "models": {
        "produces": [],
        "consumes": [
          {
            "bus": "market-redis",
            "key": "massive:model:spot"
          },
          {
            "bus": "market-redis",
            "key": "massive:gex:model"
          },
          {
            "bus": "market-redis",
            "key": "massive:heatmap:model:{symbol}:latest"
          },
          {
            "bus": "market-redis",
            "key": "massive:heatmap:replay:{symbol}"
          },
          {
            "bus": "market-redis",
            "key": "massive:market_mode:model"
          },
          {
            "bus": "market-redis",
            "key": "massive:vix_regime:model"
          },
          {
            "bus": "market-redis",
            "key": "massive:volume_profile:model"
          },
          {
            "bus": "market-redis",
            "key": "massive:bias_lfi:model"
          },
          {
            "bus": "market-redis",
            "key": "vexy:model:playbyplay"
          }
        ]
      },
      "dependencies": [
        "massive",
        "rss_agg",
        "vexy_ai"
      ]
    },
    "mesh": {
      "id": "mesh",
      "meta": {
        "name": "Mesh Coordinator",
        "description": "Maintains service registry and monitors heartbeat health."
      },
      "access_points": {
        "publish_to": [
          {
            "bus": "system-redis",
            "key": "mesh:heartbeat"
          },
          {
            "bus": "system-redis",
            "key": "mesh:gossip"
          }
        ],
        "subscribe_to": []
      },
      "heartbeat": {
        "interval_sec": 5,
        "ttl_sec": 15
      },
      "dependencies": []
    },
    "healer": {
      "id": "healer",
      "meta": {
        "name": "Healer",
        "description": "Watches all service heartbeats and restarts or alerts when any fail."
      },
      "access_points": {
        "subscribe_to": [
          {
            "bus": "system-redis",
            "key": "rss_agg:heartbeat"
          },
          {
            "bus": "system-redis",
            "key": "massive:heartbeat"
          },
          {
            "bus": "system-redis",
            "key": "vexy_ai:heartbeat"
          },
          {
            "bus": "system-redis",
            "key": "mesh:heartbeat"
          },
          {
            "bus": "system-redis",
            "key": "vigil:heartbeat"
          },
          {
            "bus": "system-redis",
            "key": "content_anal:heartbeat"
          }
        ],
        "publish_to": [
          {
            "bus": "system-redis",
            "key": "healer:alerts"
          }
        ]
      },
      "heartbeat": {
        "interval_sec": 10,
        "ttl_sec": 30
      },
      "dependencies": []
    }
  }
}