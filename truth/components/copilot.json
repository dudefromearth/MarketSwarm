{
  "id": "copilot",
  "meta": {
    "name": "AI Copilot",
    "description": "MEL (Model Effectiveness Layer), ADI (AI Data Interface), Commentary, and Alert services. Provides model validity scoring, canonical data export for AI assistants, one-way market observations, and real-time alert evaluation."
  },
  "access_points": {
    "subscribe_to": [
      { "bus": "market-redis", "key": "massive:spot", "description": "Live spot prices for SPX/NDX/VIX" },
      { "bus": "market-redis", "key": "massive:heatmap:model:{symbol}:latest", "description": "Heatmap tile data" }
    ],
    "publish_to": [
      { "bus": "system-redis", "key": "copilot:heartbeat", "description": "Service heartbeat" },
      { "bus": "market-redis", "key": "copilot:mel:snapshot", "description": "MEL effectiveness scores for all models" },
      { "bus": "market-redis", "key": "copilot:mel:history", "description": "Historical MEL snapshots" },
      { "bus": "market-redis", "key": "copilot:adi:snapshot", "description": "Canonical AI data interface export" },
      { "bus": "market-redis", "key": "copilot:commentary:message", "description": "AI commentary messages" },
      { "bus": "market-redis", "key": "copilot:alerts:events", "description": "Real-time alert trigger/update events (pub/sub)" },
      { "bus": "market-redis", "key": "copilot:alerts:latest", "description": "Latest alert state snapshot" },
      { "bus": "market-redis", "key": "copilot:alerts:{id}", "description": "Individual alert data by ID" }
    ]
  },
  "heartbeat": {
    "interval_sec": 5,
    "ttl_sec": 15
  },
  "models": {
    "produces": [
      { "bus": "market-redis", "key": "copilot:mel:snapshot", "description": "MEL effectiveness scores" },
      { "bus": "market-redis", "key": "copilot:adi:snapshot", "description": "Canonical AI data export" },
      { "bus": "market-redis", "key": "copilot:commentary:message", "description": "AI market commentary" },
      { "bus": "market-redis", "key": "copilot:alerts:events", "description": "Alert trigger/update events" },
      { "bus": "market-redis", "key": "copilot:alerts:latest", "description": "Latest alert state" }
    ],
    "consumes": [
      { "bus": "market-redis", "key": "massive:heatmap:model:{symbol}:latest" }
    ]
  },
  "dependencies": [
    "massive"
  ],
  "env": {
    "COPILOT_PORT": "8095",
    "COPILOT_MEL_ENABLED": "true",
    "COPILOT_ADI_ENABLED": "true",
    "COPILOT_COMMENTARY_ENABLED": "false",
    "COPILOT_ALERTS_ENABLED": "true",
    "COPILOT_MEL_INTERVAL_MS": "5000",
    "COPILOT_MEL_THRESHOLD_VALID": "70",
    "COPILOT_MEL_THRESHOLD_DEGRADED": "50",
    "COPILOT_ADI_INTERVAL_MS": "5000",
    "COPILOT_COMMENTARY_RATE_LIMIT": "10",
    "COPILOT_ALERTS_FAST_LOOP_MS": "1000",
    "COPILOT_ALERTS_SLOW_LOOP_MS": "5000",
    "DEBUG_COPILOT": "false"
  },
  "mel": {
    "weights": {
      "gamma": 0.30,
      "volume_profile": 0.25,
      "liquidity": 0.20,
      "volatility": 0.15,
      "session": 0.10
    },
    "coherenceMultipliers": {
      "STABLE": 1.0,
      "MIXED": 0.85,
      "COLLAPSING": 0.60,
      "RECOVERED": 0.90
    }
  },
  "adi": {
    "schemaVersion": "gamma_snapshot_v1.0",
    "exportFormats": ["json", "csv", "text"]
  },
  "commentary": {
    "mode": "one-way",
    "provider": "openai",
    "rateLimitPerMinute": 10
  },
  "alerts": {
    "provider": "anthropic",
    "fastLoopIntervalMs": 1000,
    "slowLoopIntervalMs": 5000,
    "maxAlertsPerUser": 50,
    "keys": {
      "events": "copilot:alerts:events",
      "latest": "copilot:alerts:latest",
      "alertPrefix": "copilot:alerts"
    },
    "roleGating": {
      "price": ["free", "basic", "premium", "admin"],
      "debit": ["free", "basic", "premium", "admin"],
      "profit_target": ["basic", "premium", "admin"],
      "trailing_stop": ["basic", "premium", "admin"],
      "ai_theta_gamma": ["premium", "admin"],
      "ai_sentiment": ["premium", "admin"],
      "ai_risk_zone": ["premium", "admin"]
    },
    "limits": {
      "free": { "maxAlerts": 5, "aiAlertsAllowed": false },
      "basic": { "maxAlerts": 20, "aiAlertsAllowed": false },
      "premium": { "maxAlerts": 50, "aiAlertsAllowed": true },
      "admin": { "maxAlerts": 100, "aiAlertsAllowed": true }
    }
  }
}
