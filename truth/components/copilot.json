{
  "id": "copilot",
  "meta": {
    "name": "AI Copilot",
    "description": "MEL (Model Effectiveness Layer), ADI (AI Data Interface), and Commentary services. Provides model validity scoring, canonical data export for AI assistants, and one-way market observations."
  },
  "access_points": {
    "subscribe_to": [
      { "bus": "market-redis", "key": "massive:spot", "description": "Live spot prices for SPX/NDX/VIX" },
      { "bus": "market-redis", "key": "massive:heatmap:model:{symbol}:latest", "description": "Heatmap tile data" }
    ],
    "publish_to": [
      { "bus": "system-redis", "key": "copilot:heartbeat", "description": "Service heartbeat" },
      { "bus": "market-redis", "key": "copilot:mel:snapshot", "description": "MEL effectiveness scores for all models" },
      { "bus": "market-redis", "key": "copilot:mel:history", "description": "Historical MEL snapshots" },
      { "bus": "market-redis", "key": "copilot:adi:snapshot", "description": "Canonical AI data interface export" },
      { "bus": "market-redis", "key": "copilot:commentary:message", "description": "AI commentary messages" }
    ]
  },
  "heartbeat": {
    "interval_sec": 5,
    "ttl_sec": 15
  },
  "models": {
    "produces": [
      { "bus": "market-redis", "key": "copilot:mel:snapshot", "description": "MEL effectiveness scores" },
      { "bus": "market-redis", "key": "copilot:adi:snapshot", "description": "Canonical AI data export" },
      { "bus": "market-redis", "key": "copilot:commentary:message", "description": "AI market commentary" }
    ],
    "consumes": [
      { "bus": "market-redis", "key": "massive:heatmap:model:{symbol}:latest" }
    ]
  },
  "dependencies": [
    "massive"
  ],
  "env": {
    "COPILOT_PORT": "8095",
    "COPILOT_MEL_ENABLED": "true",
    "COPILOT_ADI_ENABLED": "true",
    "COPILOT_COMMENTARY_ENABLED": "false",
    "COPILOT_MEL_INTERVAL_MS": "5000",
    "COPILOT_MEL_THRESHOLD_VALID": "70",
    "COPILOT_MEL_THRESHOLD_DEGRADED": "50",
    "COPILOT_ADI_INTERVAL_MS": "5000",
    "COPILOT_COMMENTARY_RATE_LIMIT": "10",
    "DEBUG_COPILOT": "false"
  },
  "mel": {
    "weights": {
      "gamma": 0.30,
      "volume_profile": 0.25,
      "liquidity": 0.20,
      "volatility": 0.15,
      "session": 0.10
    },
    "coherenceMultipliers": {
      "STABLE": 1.0,
      "MIXED": 0.85,
      "COLLAPSING": 0.60,
      "RECOVERED": 0.90
    }
  },
  "adi": {
    "schemaVersion": "gamma_snapshot_v1.0",
    "exportFormats": ["json", "csv", "text"]
  },
  "commentary": {
    "mode": "one-way",
    "provider": "openai",
    "rateLimitPerMinute": 10
  }
}
